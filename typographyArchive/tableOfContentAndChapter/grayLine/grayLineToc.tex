%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%		Basic configuration
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\documentclass[a4paper, 10pt, oneside, fleqn]{report}
\usepackage[no-math]{fontspec}

\usepackage{polyglossia}
\setdefaultlanguage{french}
\setotherlanguages{english}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%		Various packages
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\usepackage{microtype}
\usepackage{calc}
\usepackage[usenames,dvipsnames,svgnames,table]{xcolor}
\usepackage{setspace}
\usepackage{mdframed}

% My packages
\usepackage[noindent]{infoBulle}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%		Colors
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\definecolor{lightGray}{RGB}{150, 150, 150}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%		Font
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\defaultfontfeatures{Ligatures=TeX}
\frenchspacing
% For source code
\setmonofont{Source Code Pro Light}[
	BoldFont=Source Code Pro,
]
% Normal font
\setsansfont{Lato Light}[
	Numbers=OldStyle,
	BoldFont=Lato Regular,
	ItalicFont=Lato Light Italic,
	BoldItalicFont=Lato Italic
]
% Normal font
\setmainfont{Lato Light}[
	Numbers=OldStyle,
	BoldFont=Lato Regular,
	ItalicFont=Lato Light Italic,
	BoldItalicFont=Lato Italic
]
% Font for section, subsection, subsubsection, etc
\newfontfamily{\titlefont}{Lato Light}[
	Numbers=OldStyle,
	BoldFont=Lato Regular,
	ItalicFont=Lato Light Italic,
	BoldItalicFont=Lato Italic
]
% Font for chapter number
\newfontfamily{\upperNumber}{Lato Light}[
	BoldFont=Lato Regular,
	ItalicFont=Lato Light Italic,
	BoldItalicFont=Lato Italic
]
% Font for chapter title
\newfontfamily{\chapterfont}{BIRTH OF A HERO}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%		Layout
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\usepackage[
xetex,
a4paper,
ignoreheadfoot,
left=3.5cm,
right=2.7cm,
top=3cm,
bottom=3.5cm,
nohead,
marginparwidth=0cm,
marginparsep=0mm
]{geometry}
\setlength{\skip\footins}{1cm}
\setlength{\footnotesep}{2mm}
\setlength{\parskip}{1ex}
\setlength{\parindent}{0ex}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%		Titling
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\usepackage{titlesec}
% Tiltling format (font size)
\titleformat{\chapter}[display]
	{\huge}
	{\chaptertitlename}
	{20pt}
	{\fontsize{2cm}{1em}\selectfont\chapterfont}
\titleformat*{\section}{\Huge\titlefont}
\titleformat*{\subsection}{\huge\titlefont}
\titleformat*{\subsubsection}{\LARGE\titlefont}

%Titling spacing
\titlespacing*{\chapter}{0mm}{50pt}{20pt}
\titlespacing*{name=\chapter,numberless}{0pt}{20pt}{20pt} %starred version of chapter default: 0pt, 50pt, 40pt
\titlespacing*{\section}{0mm}{4mm}{3mm}
\titlespacing*{\subsection}{0mm}{3mm}{2mm}
\titlespacing*{\subsubsection}{0mm}{2mm}{1.5mm}

% Title number in margin
\makeatletter
\def\@seccntformat#1{\llap{\csname the#1\endcsname\hspace{3mm}}}
\makeatother



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%		ToC and Mini-ToC
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\usepackage{titletoc}
\usepackage{framed}

%		ToC
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\renewenvironment{leftbar}{
	\def\FrameCommand{
		\hspace*{-.2\textwidth}
		{\color{lightGray}\vrule width 2pt depth 6pt}\hspace{1em}
	}
	\MakeFramed{
		\parshape 1 0cm \dimexpr\textwidth-.5\textwidth\relax\FrameRestore
	}\vskip2pt%
}{\endMakeFramed}
\titlecontents{chapter}[0em]{\vspace*{1\baselineskip}}{
	\parbox{.1\textwidth}{\hfill\Huge\bfseries{\thecontentspage}}
	\vspace*{-3\baselineskip}\leftbar{\large\chaptertitlename~\thecontentslabel}\\\Large
}{}{\endleftbar}

%		Mini-ToC
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\makeatletter
\newcommand{\printMiniToc}{
	\hfill\parbox[t]{.25\textwidth}{
		{\mbox{}\\
			\mbox{}\bfseries{\fontsize{7cm}{1ex}\selectfont\upperNumber\hfill\thechapter}}
	}
	\parbox[t]{.65\textwidth}{\vspace*{1.5cm}
		\begin{flushright}
			{\Large\textbf{Sommaire}} \raisebox{-1.5mm}{\includegraphics[width=.75cm]{\pathToInfoBulleImages toc.png}}
		\end{flushright}
		\vspace*{-3mm}
		\begin{mdframed}[
			skipabove=0mm,
			skipbelow=0cm,
			innertopmargin=1mm,
			innerbottommargin=0mm,
			innerleftmargin=2mm,
			innerrightmargin=1.5mm,
			leftmargin=0mm,
			rightmargin=0mm,
			leftline=true,
			rightline=false,
			topline=false,
			bottomline=false,
			linewidth=1mm,
			linecolor=Gray
			]
			\startcontents[chapters]
			\hypersetup{linkcolor=black}
			\begin{spacing}{1.2}
				\printcontents[chapters]{p}{1}{\setcounter{tocdepth}{4}}
			\end{spacing}
			\vspace*{-1mm}
		\end{mdframed}
	}\hspace*{1cm}
	\vfill
	\newpage
}
\makeatother

%Redefining toc style so that it dont get indented in partialTocs
\titlecontents{psection}[2.3em]
{} {\contentslabel{2.3em}} {} {\titlerule*[1pc]{.}\contentspage}
\titlecontents{psubsection}[5.5em]
{} {\contentslabel{3.2em}} {} {\titlerule*[1pc]{.}\contentspage}




%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%		Links
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\usepackage{hyperref}
\hypersetup{
	pdftoolbar=false,
	pdfmenubar=true,
	pdffitwindow=false,
	pdfborder={1 1 0},
	pdftitle={Travail de Maturité, Réalisation d'un jeu vidéo, par Yves ZUMBACH},
	pdfauthor={Yves ZUMBACH},
	pdfsubject={Réalisation pratique d'un jeu vidéo},
	pdfcreator=LaTeX,
	pdfkeywords={{video game}{Travail de maturité}},
	colorlinks=true,
	linkcolor=blue,
	linktoc=all,
	urlcolor=blue,
	citecolor=blue,
	filecolor=blue
}




\begin{document}
	
	{\hypersetup{linkcolor=black}
		\setcounter{tocdepth}{0}
		
		\tableofcontents
	}
	
	
	\chapter{Introduction}
	\printMiniToc
	\section{Introduction}
	\section{motivation}
	\section{Logiciel}
	\subsection{Libres}
	\subsection{Propriétaires}
	
	\chapter{Création d'un univers}
	\printMiniToc
	\section{Introd}
	\section{motivation}
	\section{Logiciel}
	\subsection{Libres}
	\subsection{Propriétaires}
	\section{Introd}
	\section{motivation}
	\section{Logiciel}
	\subsection{Libres}
	\subsection{Propriétaires}
	
	\chapter[Scénarioet level design]{Scénario\\et level design}	
	
	\chapter[Gameplay, ou la façon de jouer]{Gameplay,\\ou la façon de jouer}
	
	\chapter[Scénario et level design]{Scénario\\et level design}
	
	\chapter[Gameplay, ou la façon de jouer]{Gameplay,\\ou la façon de jouer}
	
	\chapter[Scénario et level design]{Scénario\\et level design}
	
	\chapter[Gameplay, ou la façon de jouer]{Gameplay,\\ou la façon de jouer}
	
	\chapter[Scénario et level design]{Scénario\\et level design} 
	
\end{document}

